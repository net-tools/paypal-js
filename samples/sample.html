<html>
<head>
	<script src="../src/client.js"></script>
	
	<style>
		body{
			display: flex;
			flex-direction: column;
		}
		
		div#content {
			margin-bottom: 1em;
		}
		
		
		div#content div label input {
			background-color: antiquewhite;
			border:1px solid dimgray;	
		}
		
		div#content div label input[data-small='1']{
			width:4em;
		}
		
		div#actions{
			padding:0.5em;
		}
		
		textarea {
			margin-top:2em;
			height:30em;
		}
		
		div#paypalbtns {
			background-color: azure;
			padding:0.25em;
		}
		
		div#config {
			display: flex;
			flex-direction: column;
			padding-bottom: 1em;
			border-bottom: 2px solid black;
		}
		
		div#config label {
			display: flex;
		}
		
		input#paypal_client_id {
			flex-grow: 1;
		}
	</style>
	
	<script>
	function apiload()
	{
		var PAYPAL_SCRIPT = 'https://www.paypal.com/sdk/js?currency=EUR&client-id=' + document.getElementById('paypal_client_id').value;
		var script = document.createElement('script');
		script.setAttribute('src', PAYPAL_SCRIPT);
		script.onload = function(){ document.getElementById('btn_validate').disabled = document.getElementById('btn_express').disabled = false; }
		document.head.appendChild(script);
		
		
		// set id in localstorage for future use
		window.localStorage.setItem('net-tools/paypal-js:samples', document.getElementById('paypal_client_id').value);
	}
		
		
	function v(id)
	{
		return document.getElementById(id).value;
	}
	
		
	
	function go()
	{
		// reset buttons
		document.getElementById('paypalbtns').innerHTML = "";
		document.getElementById('log').value = '';
		
		
		// create shop and set currency code for all API calls
		var shop = new NTPaypal.Shop('EUR');
		
		// create the customer
		var cust = shop.newCustomer(v('cust_firstname'), {
				surname : 		v('cust_surname'),
				address1 : 		v('cust_address'), 
				zipcode : 		v('cust_zipcode'),
				city : 			v('cust_city'), 
				countrycode : 	v('cust_country'),
				email :		 	v('cust_email')
			});
		
		if ( v('cust_mphone') )
		{
			cust.phone = v('cust_mphone');
			cust.phone_type = 'MOBILE';
		}
		
		
		// create the products
		var p1 = shop.newItem(v('p1_title'), v('p1_sku'), v('p1_quantity'), v('p1_price'), 'PHYSICAL_GOODS', {tax:v('p1_tax'), description:v('p1_descr')});
		if ( v('p2_title') )
			var p2 = shop.newItem(v('p2_title'), v('p2_sku'), v('p2_quantity'), v('p2_price'), 'DIGITAL_GOODS', {tax:v('p2_tax'), description:v('p2_descr')});
		else
			var p2 = null;
		
		// create shopping cart
		var cart = shop.newCart(p2?[p1,p2]:[p1]);
		
		// create order with shipping cost 0€
		var order = shop.newOrder(cart, {
				customer : cust,
				shipping : 0,
				description : 'Demo shopping cart content'
			});
		
		// show paypal button
		shop.paypalButton(order, '#paypalbtns').then(function(data)
				{
					var log = 'Paypal process OK\nThe transaction number is ' + data.purchase_units[0].payments.captures[0].id + '\n';
					log += JSON.stringify(data, null, 3);
					document.getElementById('log').value = log;
			
			
					// reset paypal buttons
					document.getElementById('paypalbtns').innerHTML = "";
				}
			)
			.catch(function(data)
				{
					document.getElementById('log').value = 'ko\n' + JSON.stringify(data);
				}
			);
	}
		
		
		
	function express()
	{
		// reset buttons
		document.getElementById('paypalbtns').innerHTML = "";
		document.getElementById('log').value = '';
		
		
		// create shop and set currency code for all API calls
		var shop = new NTPaypal.Shop('EUR');
		shop.expressBuy('Express buy product 1', 10, null, '#paypalbtns').then(function(data)
				{
					var log = 'Paypal express buy process OK\nThe transaction number is ' + data.purchase_units[0].payments.captures[0].id + '\n';
					log += JSON.stringify(data, null, 3);
					document.getElementById('log').value = log;
			
			
					// reset paypal buttons
					document.getElementById('paypalbtns').innerHTML = "";
				}
			)
			.catch(function(data)
				{
					document.getElementById('log').value = 'ko\n' + JSON.stringify(data);
				}
			);
	}
		
	</script>
	
</head>
	
<body>
	<div id="config">
		<label>Paypal Client-ID : <input type="text" name="paypal_client_id" id="paypal_client_id" placeholder="paypal client ID" ></label>
		<label>Load API<input type="button" onclick="apiload();" value="Load API with Paypal client ID above"></label>
	</div>
	
	<div id="content">
		<p><strong>Shopping cart content</strong></p>
		<div>
			<label>Product : 	<input type="text" id="p1_title" placeholder="great_product_here" value="great_product_1"></label>
			<label>SKU : 		<input type="text" id="p1_sku" placeholder="prod_id_9999" value="p_id_1" data-small="1"></label>
			<label>Quantity : 	<input type="text" id="p1_quantity" placeholder="1..99" value="1" data-small="1"></label>
			<label>Price : 		<input type="text" id="p1_price" placeholder="1..999" value="15" data-small="1"></label>
			<label>Tax : 		<input type="text" id="p1_tax" placeholder="1..99" value="0" data-small="1"></label>
			<label>Description :<input type="text" id="p1_descr" placeholder="long description here" value="great product 1 here"></label>
		</div>
		<hr>
		<div>
			<label>Product : 	<input type="text" id="p2_title" placeholder="great_product_here" value=""></label>
			<label>SKU : 		<input type="text" id="p2_sku" placeholder="prod_id_9999" value="" data-small="1"></label>
			<label>Quantity : 	<input type="text" id="p2_quantity" placeholder="1..99" value="" data-small="1"></label>
			<label>Price : 		<input type="text" id="p2_price" placeholder="1..999" value="" data-small="1"></label>
			<label>Tax : 		<input type="text" id="p2_tax" placeholder="1..99" value="" data-small="1"></label>
			<label>Description :<input type="text" id="p2_descr" placeholder="long description here" value=""></label>
		</div>
		
		<hr>
		
		<p><strong>Customer details</strong></p>
		<div>
			<label>First name: 	<input type="text" id="cust_firstname" placeholder="john" value="John" data-small="1"></label>
			<label>Surname: 	<input type="text" id="cust_surname" placeholder="doe" value="Doe" data-small="1"></label>
			<label>Address: 	<input type="text" id="cust_address" placeholder="12, Kensington Avenue" value="12, Kensington Avenue"></label>
			<label>Zipcode: 	<input type="text" id="cust_zipcode" placeholder="Area-code" value="75000" data-small="1"></label>
			<label>City: 		<input type="text" id="cust_city" placeholder="City" value="Paris" data-small="1"></label>
			<label>Country_code:<input type="text" id="cust_country" placeholder="US" value="FR" data-small="1"></label>
			<label>Email: 		<input type="text" id="cust_email" placeholder="john.doe@gmail.com" value="john.doe@gmail.com"></label>
			<label>Phone: 		<input type="text" id="cust_mphone" placeholder="0601020304" value="0601020304"></label>
		</div>
		
	</div>
	
	<div id="actions">
		<input type="button" value="Validate shopping cart" onclick="go();" id="btn_validate" disabled> 
		<input type="button" value="Express buy 10€ (no cart)" onclick="express();" id="btn_express" disabled> (please set client-ID first above)
	</div>
	
	<div id="paypalbtns"></div>
	
	<textarea id="log"></textarea>
	
	<script>
	var paypal_client_id = '';
	if ( paypal_client_id = window.localStorage.getItem('net-tools/paypal-js:samples') )
		document.getElementById('paypal_client_id').value = paypal_client_id;
	</script>
	
</body>

</html>